<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>알림</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; }
    .row { border:1px solid #ddd; border-radius:10px; padding:12px; margin-bottom:10px; }
    .unread { background:#fffdf3; }
    .meta { color:#666; font-size:13px; }
    button { padding:6px 10px; border:1px solid #333; border-radius:8px; background:#fff; cursor:pointer; }
    .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1 style="margin:0;">알림</h1>
    <button id="readAll">모두 읽음 처리</button>
  </div>
  <div id="list">불러오는 중…</div>

<script>
  const list = document.getElementById('list');

  async function load(){
    list.textContent = '불러오는 중…';
    const res = await fetch('/api/notifications');
    const data = await res.json();
    const items = data.items || [];
    if (items.length === 0) { list.textContent = '알림이 없습니다'; return; }

    list.innerHTML = '';
    items.forEach(n => {
      const div = document.createElement('div');
      div.className = 'row' + (n.readAt ? '' : ' unread');
      div.innerHTML = `
        <div class="meta">${n.type} · ${n.createdAt?.replace('T',' ')}</div>
        <div style="font-weight:700; margin:6px 0 4px 0;">${n.title || '-'}</div>
        <div>${n.message || ''}</div>
        <div style="margin-top:8px;">
          ${n.readAt ? '<span class="meta">읽음</span>' : '<button data-id="'+n.id+'">읽음 처리</button>'}
        </div>
      `;
      if (!n.readAt) {
        div.querySelector('button').onclick = async () => {
          await fetch('/api/notifications/' + n.id + '/read', { method:'POST' });
          load();
        };
      }
      list.appendChild(div);
    });
  }

  document.getElementById('readAll').onclick = async () => {
    await fetch('/api/notifications/read-all', { method:'POST' });
    load();
  };

  load();
</script>
</body>
</html>
