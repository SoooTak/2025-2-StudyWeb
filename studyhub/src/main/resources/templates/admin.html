<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>리더 콘솔(임시)</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; }
    input, button { padding: 6px 8px; }
    table { border-collapse: collapse; width: 100%; margin-top: 12px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f7f7f7; }
  </style>
</head>
<body>
  <h1>리더 콘솔(임시)</h1>

  <label>스터디 ID:
    <input type="number" id="studyId" value="1"/>
  </label>
  <button id="load">대기중 불러오기</button>

  <table>
    <thead>
      <tr><th>appId</th><th>userId</th><th>status</th><th>액션</th></tr>
    </thead>
    <tbody id="rows"><tr><td colspan="4">불러오기를 누르세요</td></tr></tbody>
  </table>

<script>
  const rows = document.getElementById('rows');
  document.getElementById('load').onclick = () => {
    const id = document.getElementById('studyId').value;
    fetch(`/api/admin/pending?studyId=${id}`)
      .then(r => r.json())
      .then(data => {
        const items = data.items || [];
        if (items.length === 0) {
          rows.innerHTML = '<tr><td colspan="4">대기중 신청 없음</td></tr>';
          return;
        }
        rows.innerHTML = '';
        items.forEach(a => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${a.id}</td>
            <td>${a.userId}</td>
            <td>${a.status}</td>
            <td>
              <button data-action="approve" data-id="${a.id}">승인</button>
              <button data-action="reject" data-id="${a.id}">거절</button>
            </td>
          `;
          tr.querySelector('[data-action="approve"]').onclick = () => {
            fetch(`/api/applications/${a.id}/approve`, { method: 'POST' })
              .then(r => r.json())
              .then(res => { alert('승인: ' + (res.status || res.message)); document.getElementById('load').click(); });
          };
          tr.querySelector('[data-action="reject"]').onclick = () => {
            fetch(`/api/applications/${a.id}/reject`, { method: 'POST' })
              .then(r => r.json())
              .then(res => { alert('거절: ' + (res.status || res.message)); document.getElementById('load').click(); });
          };
          rows.appendChild(tr);
        });
      });
  };
</script>
</body>
</html>
